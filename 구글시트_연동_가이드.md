# 구글 시트 연동 가이드

구글 시트를 통해 사전예약 데이터를 **저장하고 조회**할 수 있습니다.

## 📋 기능

-   ✅ 모달창 제출 시 구글 시트에 자동 저장
-   ✅ 파트너스 코드 조회 시 구글 시트에서 검색
-   ✅ 로컬 저장소와 구글 시트 데이터 통합 조회

---

## 1단계: 구글 시트 생성

1. [Google Sheets](https://sheets.google.com)에서 새 스프레드시트를 만듭니다
2. 첫 번째 행에 다음 헤더를 입력하세요:

| A열        | B열  | C열    | D열     | E열      | F열      | G열           | H열      |
| ---------- | ---- | ------ | ------- | -------- | -------- | ------------- | -------- |
| 타임스탬프 | 이름 | 연락처 | 이메일  | 입금일시 | 입금자명 | 파트너스 코드 | 고유코드 |

---

## 2단계: Google Apps Script 설정

1. 구글 시트에서 **확장 프로그램** → **Apps Script** 클릭
2. 프로젝트 이름을 "리워드몰 데이터 수집"으로 변경
3. 기본 코드를 모두 지우고 `google-apps-script.js` 파일의 코드를 붙여넣으세요

---

## 3단계: 웹 앱 배포

1. Apps Script 편집기에서 **배포** → **새 배포** 클릭
2. **유형 선택** → **웹 앱** 선택
3. 설정:
    - **설명**: "리워드몰 사전예약 데이터 수집 및 조회"
    - **다음 계정으로 실행**: **나**
    - **액세스 권한**: **모든 사용자** (중요!)
4. **배포** 버튼 클릭
5. 권한 승인 (필요시 "안전하지 않은 앱 허용")
6. **웹 앱 URL** 복사
    - 예: `https://script.google.com/macros/s/AKfycbz.../exec`

---

## 4단계: 웹사이트에 URL 적용

`app.js` 파일의 14번 줄에 복사한 웹 앱 URL을 입력하세요:

```javascript
const GOOGLE_SHEET_URL = "https://script.google.com/macros/s/AKfycbz.../exec";
```

---

## 5단계: 테스트

### 데이터 저장 테스트

1. 웹사이트에서 사전예약 버튼 클릭
2. 모달창에 정보 입력 후 제출
3. 구글 시트에 새로운 행이 추가되었는지 확인

### 데이터 조회 테스트

1. 웹사이트의 "파트너스 코드 조회" 섹션으로 이동
2. 이름, 연락처 또는 이메일 중 하나 입력
3. **조회하기** 버튼 클릭
4. 구글 시트에 저장된 데이터가 조회되는지 확인

---

## 🔧 문제 해결

### 조회가 안 될 때

1. **액세스 권한 확인**

    - Apps Script 배포 시 "모든 사용자"로 설정했는지 확인
    - 배포 후 URL이 정확히 복사되었는지 확인

2. **브라우저 콘솔 확인**

    - F12로 개발자 도구 열기
    - Console 탭에서 에러 메시지 확인

3. **Apps Script 로그 확인**
    - Apps Script 편집기에서 **실행** → **실행 로그** 확인

### 저장은 되는데 조회가 안 될 때

-   Apps Script의 doGet 함수가 제대로 구현되었는지 확인
-   구글 시트 첫 번째 행에 헤더가 올바르게 입력되었는지 확인
-   데이터가 2행부터 입력되고 있는지 확인

---

## 📊 데이터 구조

### 저장되는 데이터

| 필드           | 설명                    | 예시                                  |
| -------------- | ----------------------- | ------------------------------------- |
| 타임스탬프     | 자동 생성               | 2025-11-17 14:30:00                   |
| 이름           | 사용자 입력             | 홍길동                                |
| 연락처         | 사용자 입력             | 010-1234-5678                         |
| 이메일         | 사용자 입력             | user@example.com                      |
| 입금일시       | 사용자 입력             | 2025-11-17T14:00                      |
| 입금자명       | 사용자 입력             | 홍길동                                |
| 파트너스 코드  | 추천인 코드 (선택사항)  | P7K4X2M9                              |
| 고유코드       | 자동 생성               | P7K4X2M9                              |

### 조회 로직

-   **OR 조건**: 이름, 연락처, 이메일 중 하나만 일치해도 검색됨
-   **부분 일치**: "홍"으로 검색하면 "홍길동", "김홍철" 모두 검색
-   **대소문자 무시**: "HONG"과 "hong" 동일하게 처리
-   **공백/하이픈 무시**: "010-1234-5678"과 "01012345678" 동일하게 처리

---

## ⚠️ 주의사항

1. **보안**

    - 웹 앱 URL을 공개 저장소에 올리지 마세요
    - 중요한 개인정보가 포함되므로 시트 공유 권한을 신중히 관리하세요

2. **배포 업데이트**

    - Apps Script 코드 수정 후에는 **새 배포**를 해야 합니다
    - 기존 배포를 수정하는 것보다 새 배포를 권장합니다

3. **성능**

    - 데이터가 많아지면 조회 속도가 느려질 수 있습니다
    - 필요시 구글 시트 대신 실제 데이터베이스 사용을 권장합니다

4. **중복 데이터**
    - 로컬 저장소와 구글 시트 모두에서 조회하므로 중복이 발생할 수 있습니다
    - 고유코드를 기준으로 자동 중복 제거됩니다

---

## 🎯 다음 단계

-   [ ] 실제 결제 시스템 연동 (PG)
-   [ ] 관리자 대시보드 구축
-   [ ] 이메일 알림 기능 추가
-   [ ] 데이터 백업 자동화

---

## 📞 문의

문제가 발생하면 브라우저 콘솔(F12)과 Apps Script 실행 로그를 확인하세요.

